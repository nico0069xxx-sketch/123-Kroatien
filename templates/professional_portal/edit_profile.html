{% extends 'include/base.html' %}
{% load static %}
{% block title %}Profil bearbeiten{% endblock %}
{% block body %}
<style>
.edit-container { max-width: 900px; margin: 40px auto; padding: 20px; }
.edit-header { margin-bottom: 30px; }
.edit-header h1 { color: #1e3a5f; font-size: 1.8rem; }
.edit-header a { color: #666; text-decoration: none; }
.edit-form { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
.form-section { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
.form-section:last-child { border-bottom: none; margin-bottom: 0; }
.section-title { font-size: 1.1rem; font-weight: 600; color: #1e3a5f; margin-bottom: 20px; }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px; }
.form-group { margin-bottom: 15px; }
.form-group label { display: block; font-weight: 500; color: #333; margin-bottom: 8px; }
.form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem; }
.form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #1e3a5f; }
.form-group textarea { min-height: 120px; resize: vertical; }
.btn-save { background: #1e3a5f; color: white; padding: 14px 40px; border: none; border-radius: 8px; font-size: 1rem; cursor: pointer; }
.btn-save:hover { background: #2d5a87; }
.btn-back { color: #666; text-decoration: none; margin-right: 20px; }
.btn-container { margin-top: 30px; display: flex; align-items: center; justify-content: space-between; }
.alert-success { background: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
.btn-ki { background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; margin-bottom: 15px; }
.btn-ki:hover { background: #218838; }
.btn-ki:disabled { background: #ccc; cursor: not-allowed; }
.ki-suggestions { background: #f8f9fa; border-radius: 8px; padding: 20px; margin-top: 15px; display: none; }
.ki-suggestion { background: white; border: 2px solid #e9ecef; border-radius: 8px; padding: 15px; margin-bottom: 15px; cursor: pointer; }
.ki-suggestion:hover { border-color: #1e3a5f; }
.ki-suggestion.selected { border-color: #28a745; background: #f0fff0; }
.ki-suggestion-title { font-weight: 600; color: #1e3a5f; margin-bottom: 10px; }
.ki-suggestion-text { color: #666; font-size: 0.95rem; line-height: 1.5; }
.lang-tabs { display: flex; gap: 10px; margin-bottom: 15px; }
.lang-tab { padding: 8px 16px; border: 2px solid #e9ecef; border-radius: 8px; cursor: pointer; background: white; }
.lang-tab.active { background: #1e3a5f; color: white; border-color: #1e3a5f; }
.loading { text-align: center; padding: 20px; color: #666; }
@media (max-width: 600px) { .form-row { grid-template-columns: 1fr; } }
</style>
<div class="edit-container">
<div class="edit-header">
<a href="{% url 'professional_portal:dashboard' %}">‚Üê Zurueck zum Dashboard</a>
<h1>Profil bearbeiten</h1>
</div>
{% if messages %}
{% for message in messages %}
<div class="alert-success">{{ message }}</div>
{% endfor %}
{% endif %}
<form method="post" class="edit-form" enctype="multipart/form-data">
{% csrf_token %}
<div class="form-section">
<h3 class="section-title">Persoenliche Daten</h3>
<div class="form-row">
<div class="form-group">
<label>Name / Firmenname *</label>
<input type="text" name="name" value="{{ professional.name }}" required>
</div>
<div class="form-group">
<label>E-Mail *</label>
<input type="email" name="email" value="{{ professional.email }}" required>
</div>
</div>
<div class="form-row">
<div class="form-group">
<label>Telefon</label>
<input type="text" name="phone" value="{{ professional.phone|default:'' }}">
</div>
<div class="form-group">
<label>Mobil</label>
<input type="text" name="mobile" value="{{ professional.mobile|default:'' }}">
</div>
</div>
</div>
<div class="form-section">
<h3 class="section-title">Adresse</h3>
<div class="form-row">
<div class="form-group">
<label>Stadt</label>
<input type="text" name="city" value="{{ professional.city|default:'' }}">
</div>
<div class="form-group">
<label>Region</label>
<select name="region">
<option value="">-- Bitte waehlen --</option>
<option value="istrien" {% if professional.region == 'istrien' %}selected{% endif %}>Istrien</option>
<option value="kvarner" {% if professional.region == 'kvarner' %}selected{% endif %}>Kvarner</option>
<option value="dalmatien" {% if professional.region == 'dalmatien' %}selected{% endif %}>Dalmatien</option>
<option value="zagreb" {% if professional.region == 'zagreb' %}selected{% endif %}>Zagreb</option>
<option value="slavonien" {% if professional.region == 'slavonien' %}selected{% endif %}>Slavonien</option>
<option value="andere" {% if professional.region == 'andere' %}selected{% endif %}>Andere</option>
</select>
</div>
</div>
<div class="form-group">
<label>Strasse und Hausnummer</label>
<input type="text" name="address" value="{{ professional.address|default:'' }}">
</div>
</div>
<div class="form-section">
<h3 class="section-title">Online-Praesenz</h3>
<div class="form-group">
<label>Website</label>
<input type="url" name="website" value="{{ professional.website|default:'' }}" placeholder="https://...">
</div>
<div class="form-row">
<div class="form-group">
<label>Facebook</label>
<input type="url" name="facebook" value="{{ professional.facebook|default:'' }}">
</div>
<div class="form-group">
<label>Instagram</label>
<input type="url" name="instagram" value="{{ professional.instagram|default:'' }}">
</div>
</div>
<div class="form-group">
<label>LinkedIn</label>
<input type="url" name="linkedin" value="{{ professional.linkedin|default:'' }}">
</div>
</div>
<div class="form-section">
<h3 class="section-title">Beschreibung</h3>
<div class="lang-tabs">
<div class="lang-tab active" data-lang="de">Deutsch</div>
<div class="lang-tab" data-lang="hr">Kroatisch</div>
<div class="lang-tab" data-lang="en">Englisch</div>
</div>
<button type="button" class="btn-ki" onclick="generateKI()">
<i class="fa fa-magic"></i> KI-Text generieren
</button>
<div id="ki-suggestions" class="ki-suggestions">
<div class="loading" id="ki-loading">Text wird generiert...</div>
<div id="ki-results"></div>
</div>
<div id="desc-de" class="desc-field">
<div class="form-group">
<label>Beschreibung (Deutsch)</label>
<textarea name="description_de" id="description_de" placeholder="Beschreibe deine Dienstleistungen...">{{ professional.description_de|default:'' }}</textarea>
</div>
</div>
<div id="desc-hr" class="desc-field" style="display:none;">
<div class="form-group">
<label>Beschreibung (Kroatisch)</label>
<textarea name="description_hr" id="description_hr" placeholder="Opisite svoje usluge...">{{ professional.description_hr|default:'' }}</textarea>
</div>
</div>
<div id="desc-en" class="desc-field" style="display:none;">
<div class="form-group">
<label>Beschreibung (Englisch)</label>
<textarea name="description_en" id="description_en" placeholder="Describe your services...">{{ professional.description_en|default:'' }}</textarea>
</div>
</div>
<div class="form-group">
<label>Gesprochene Sprachen</label>
<input type="text" name="languages" value="{{ professional.languages_spoken|default:'' }}" placeholder="z.B. Deutsch, Kroatisch, Englisch">
</div>
</div>
<div class="btn-container">
<a href="{% url 'professional_portal:dashboard' %}" class="btn-back">Abbrechen</a>
<button type="submit" class="btn-save">Speichern</button>
</div>
</form>
</div>
<script>
let currentLang = 'de';
document.querySelectorAll('.lang-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        document.querySelectorAll('.lang-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        currentLang = this.dataset.lang;
        document.querySelectorAll('.desc-field').forEach(f => f.style.display = 'none');
        document.getElementById('desc-' + currentLang).style.display = 'block';
    });
});

function generateKI() {
    const btn = document.querySelector('.btn-ki');
    const container = document.getElementById('ki-suggestions');
    const loading = document.getElementById('ki-loading');
    const results = document.getElementById('ki-results');
    
    btn.disabled = true;
    btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Generiere...';
    container.style.display = 'block';
    loading.style.display = 'block';
    results.innerHTML = '';
    
    const langMap = {'de': 'ge', 'hr': 'hr', 'en': 'en'};
    
    fetch('/ge/portal/ki-beschreibung/?lang=' + langMap[currentLang])
        .then(response => response.json())
        .then(data => {
            loading.style.display = 'none';
            btn.disabled = false;
            btn.innerHTML = '<i class="fa fa-magic"></i> KI-Text generieren';
            
            if (data.error) {
                results.innerHTML = '<p style="color:red;">Fehler: ' + data.error + '</p>';
                return;
            }
            
            let html = '';
            for (const [key, value] of Object.entries(data.suggestions)) {
                html += '<div class="ki-suggestion" onclick="selectSuggestion(this, \'' + currentLang + '\')">';
                html += '<div class="ki-suggestion-title">' + value.style_name + '</div>';
                html += '<div class="ki-suggestion-text">' + value.text + '</div>';
                html += '</div>';
            }
            results.innerHTML = html;
        })
        .catch(err => {
            loading.style.display = 'none';
            btn.disabled = false;
            btn.innerHTML = '<i class="fa fa-magic"></i> KI-Text generieren';
            results.innerHTML = '<p style="color:red;">Fehler beim Laden.</p>';
        });
}

function selectSuggestion(el, lang) {
    document.querySelectorAll('.ki-suggestion').forEach(s => s.classList.remove('selected'));
    el.classList.add('selected');
    const text = el.querySelector('.ki-suggestion-text').innerText;
    const fieldMap = {'de': 'description_de', 'hr': 'description_hr', 'en': 'description_en'};
    document.getElementById(fieldMap[lang]).value = text;
}
</script>
{% endblock body %}

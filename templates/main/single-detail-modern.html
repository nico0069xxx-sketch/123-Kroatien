{% extends 'include/base.html' %}
{% load static %}
{% block title %}{{ listing.json_content.property_title }}{% endblock %}
{% block body %}

<!-- Schema.org - RealEstateListing (GEO KÃ¶nigsklasse) -->
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "RealEstateListing",
    "name": "{{ listing.json_content.property_title }}",
    "description": "{{ listing.json_content.description|truncatechars:200 }}",
    "url": "https://123-kroatien.eu{{ request.path }}",
    "datePosted": "{{ listing.created_date|date:'Y-m-d' }}",
    "image": ["{% if listing.photo_main %}https://123-kroatien.eu{{ listing.photo_main.url }}{% endif %}"],
    "address": {
        "@type": "PostalAddress",
        "addressLocality": "{{ listing.city }}",
        "addressRegion": "{{ listing.region }}",
        "addressCountry": "HR"
    },
    "offers": {
        "@type": "Offer",
        "price": "{{ listing.property_price }}",
        "priceCurrency": "EUR",
        "availability": "https://schema.org/InStock"
    },
    "numberOfRooms": "{{ listing.bedrooms|default:'0' }}",
    "floorSize": {
        "@type": "QuantitativeValue",
        "value": "{{ listing.interior_size|default:'0' }}",
        "unitCode": "MTK"
    }
}
</script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Manrope:wght@400;500;600;700&display=swap');
:root{--primary:#003167;--primary-light:#0056b3;--accent:#db0000;--bg:#F9F8F6;--bg-white:#fff;--text:#0A0A0A;--text-muted:#64748B;--border:#E2E2E2;--shadow:0 4px 20px rgba(0,0,0,.08)}
.pd{font-family:'Manrope',sans-serif;color:var(--text)}
.pd h1,.pd h2,.pd h3{font-family:'Playfair Display',serif;color:var(--primary)}
.gallery-wrapper{position:relative;background:#1e3a5f}
.gallery-main{position:relative;width:100%;height:65vh;min-height:400px;overflow:hidden}
@media(max-width:768px){.gallery-main{height:50vh;min-height:300px}}
.gallery-slider{display:flex;transition:transform .4s ease;height:100%;touch-action:pan-y}
.gallery-slide{min-width:100%;height:100%;position:relative}
.gallery-slide img{width:100%;height:100%;object-fit:cover}
.gallery-overlay{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,rgba(0,0,0,.8));padding:60px 50px 40px;color:#fff}
@media(max-width:768px){.gallery-overlay{padding:40px 20px 30px}}
.badge{background:var(--accent);color:#fff;padding:10px 20px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:2px;display:inline-block;margin-bottom:16px;border-radius:4px;box-shadow:0 4px 15px rgba(0,0,0,.5)}
.gallery-overlay h1{font-size:clamp(24px,5vw,48px);color:#fff;margin:0 0 12px;line-height:1.15;text-shadow:0 2px 20px rgba(0,0,0,1),0 0 40px rgba(0,0,0,.8)}
.gallery-location{display:flex;align-items:center;gap:10px;font-size:18px;color:#fff;text-shadow:0 2px 20px rgba(0,0,0,1),0 0 40px rgba(0,0,0,.8);font-weight:600}
@media(max-width:768px){.gallery-location{font-size:14px}}
.gallery-location i{color:var(--accent);text-shadow:none}
.gallery-counter{position:absolute;top:20px;right:20px;background:rgba(0,0,0,.6);color:#fff;padding:8px 16px;border-radius:20px;font-size:14px;font-weight:600;z-index:10}
.gallery-dots{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);display:flex;gap:8px;z-index:10}
.gallery-dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.5);cursor:pointer;transition:all .3s;border:none}
.gallery-dot.active{background:#fff;transform:scale(1.2)}
@media(max-width:768px){.gallery-dots{bottom:100px}}
.thumbs{display:flex;gap:10px;padding:20px 50px;background:var(--bg-white);overflow-x:auto}
@media(max-width:768px){.thumbs{display:none}}
.thumb{flex:0 0 100px;height:70px;border-radius:10px;overflow:hidden;cursor:pointer;opacity:.5;border:3px solid transparent;transition:all .3s}
.thumb.active,.thumb:hover{opacity:1;border-color:var(--primary)}
.thumb img{width:100%;height:100%;object-fit:cover}
.swipe-hint{display:none;text-align:center;padding:12px;background:var(--bg);color:var(--text-muted);font-size:13px}
@media(max-width:768px){.swipe-hint{display:block}}
.content{max-width:1300px;margin:0 auto;padding:50px;display:grid;grid-template-columns:1fr 380px;gap:50px}
@media(max-width:1024px){.content{grid-template-columns:1fr;padding:25px 20px;gap:30px}}
.back-link{display:inline-flex;align-items:center;gap:8px;color:var(--text-muted);text-decoration:none;font-weight:600;margin-bottom:25px;transition:all .3s}
.back-link:hover{color:var(--primary);gap:12px}
.price-section{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:30px;padding-bottom:30px;border-bottom:1px solid var(--border);gap:15px}
.price-tag{font-size:clamp(28px,4vw,42px);font-weight:700;color:var(--primary);font-family:'Manrope',sans-serif}
.prop-id{font-size:13px;color:var(--text-muted);background:var(--bg);padding:10px 18px;border-radius:25px;font-weight:600}
.specs{display:grid;grid-template-columns:repeat(4,1fr);background:var(--bg);border-radius:16px;overflow:hidden;margin-bottom:40px}
@media(max-width:768px){.specs{grid-template-columns:repeat(2,1fr)}}
.spec{padding:24px 16px;text-align:center;border-right:1px solid var(--border);border-bottom:1px solid var(--border)}
.spec:nth-child(4n){border-right:none}
@media(max-width:768px){.spec:nth-child(2n){border-right:none}}
.spec:nth-child(n+5){border-bottom:none}
@media(max-width:768px){.spec:nth-child(n+7){border-bottom:none}.spec:nth-child(5),.spec:nth-child(6){border-bottom:1px solid var(--border)}}
.spec-icon{width:45px;height:45px;margin:0 auto 12px;display:flex;align-items:center;justify-content:center;background:var(--bg-white);border-radius:12px;color:var(--primary);font-size:18px;box-shadow:var(--shadow)}
.spec-value{font-size:22px;font-weight:700;color:var(--text);line-height:1;font-family:'Manrope',sans-serif}
@media(max-width:768px){.spec-value{font-size:20px}}
.spec-lbl{font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;margin-top:6px;font-family:'Manrope',sans-serif}
.section{margin-bottom:40px}
.section-title{font-size:20px;margin-bottom:18px;display:flex;align-items:center;gap:15px}
.section-title:after{content:'';flex:1;height:1px;background:var(--border)}
.desc-text{font-size:15px;line-height:1.85;color:var(--text-muted)}
.details-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:0}
@media(max-width:600px){.details-grid{grid-template-columns:1fr}}
.detail-row{display:flex;justify-content:space-between;padding:14px 0;border-bottom:1px solid var(--border)}
.detail-lbl{color:var(--text-muted);font-size:14px}
.detail-val{font-weight:600;color:var(--text);font-size:14px}
.map-container{border-radius:16px;overflow:hidden;height:250px;border:1px solid var(--border)}
.map-container iframe{width:100%;height:100%;border:none}
.sidebar{display:flex;flex-direction:column;gap:20px}
.card{background:var(--bg-white);border-radius:20px;padding:25px;box-shadow:var(--shadow);border:1px solid var(--border)}
.card-title{font-size:17px;margin-bottom:18px;text-align:center}
.agent-box{display:flex;align-items:center;gap:14px;padding:16px;background:var(--bg);border-radius:14px;margin-bottom:18px}
.agent-img{width:60px;height:60px;border-radius:50%;object-fit:cover;border:3px solid var(--bg-white);box-shadow:var(--shadow)}
.agent-name{font-weight:700;color:var(--text);font-size:15px;margin-bottom:2px}
.agent-role{font-size:12px;color:var(--text-muted)}
.form-group{margin-bottom:12px}
.form-group label{display:block;font-size:11px;font-weight:600;color:var(--text);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px;font-family:'Manrope',sans-serif}
input,textarea{width:100%;padding:13px 15px;border:1px solid var(--border);border-radius:10px;font-size:15px;font-family:'Manrope',sans-serif;background:var(--bg);transition:all .3s;box-sizing:border-box}
input:focus,textarea:focus{outline:none;border-color:var(--primary);background:var(--bg-white);box-shadow:0 0 0 3px rgba(0,49,103,.1)}
textarea{min-height:80px;resize:vertical}
.pd .btn{width:100%;padding:15px;border:none;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:all .3s;font-family:'Manrope',sans-serif}
.pd .btn-primary{background:var(--primary);color:#fff}
.btn-primary:hover{background:var(--primary-light);transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,49,103,.25)}
.pd .btn-secondary{background:transparent;color:var(--primary);border:2px solid var(--primary);margin-top:10px;text-decoration:none}
.btn-secondary:hover{background:var(--bg)}
.lightbox{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.95);z-index:9999;align-items:center;justify-content:center}
.lightbox.active{display:flex}
.lightbox img{max-width:90vw;max-height:90vh;object-fit:contain}
.lightbox-close{position:absolute;top:20px;right:25px;color:#fff;font-size:35px;cursor:pointer;opacity:.8;background:none;border:none}
.lightbox-close:hover{opacity:1}
.lightbox-nav{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.2);border:none;width:50px;height:50px;border-radius:50%;cursor:pointer;color:#fff;font-size:20px}
.lightbox-nav.prev{left:20px}
.lightbox-nav.next{right:20px}
</style>
<div class="pd">
<div class="gallery-wrapper">
<div class="gallery-main">
<div class="gallery-slider" id="gallerySlider">
{% if listing.photo_main %}<div class="gallery-slide" onclick="openLightbox(0)"><img src="{{ listing.photo_main.url }}" alt="1"></div>{% endif %}
{% if listing.photo_1 %}<div class="gallery-slide" onclick="openLightbox(1)"><img src="{{ listing.photo_1.url }}" alt="2"></div>{% endif %}
{% if listing.photo_2 %}<div class="gallery-slide" onclick="openLightbox(2)"><img src="{{ listing.photo_2.url }}" alt="3"></div>{% endif %}
{% if listing.photo_3 %}<div class="gallery-slide" onclick="openLightbox(3)"><img src="{{ listing.photo_3.url }}" alt="4"></div>{% endif %}
{% if listing.photo_4 %}<div class="gallery-slide" onclick="openLightbox(4)"><img src="{{ listing.photo_4.url }}" alt="5"></div>{% endif %}
{% if listing.photo_5 %}<div class="gallery-slide" onclick="openLightbox(5)"><img src="{{ listing.photo_5.url }}" alt="6"></div>{% endif %}
{% if listing.photo_6 %}<div class="gallery-slide" onclick="openLightbox(6)"><img src="{{ listing.photo_6.url }}" alt="7"></div>{% endif %}
</div>
<div class="gallery-overlay">
<span class="badge">{% if listing.property_status == "Sale" or listing.property_status == "Zu verkaufen" or "sale" in listing.property_status|lower or "verkauf" in listing.property_status|lower %}{{ status_translations.Sale }}{% else %}{{ status_translations.Rent }}{% endif %}</span>
<h1>{{ listing.json_content.property_title }}</h1>
<p class="gallery-location"><i class="fa fa-map-marker"></i> {{ listing.json_content.city|default:listing.location }}, {{ country_name_translated }}</p>
</div>
<div class="gallery-counter"><span id="currentSlide">1</span> / <span id="totalSlides">1</span></div>
<div class="gallery-dots" id="galleryDots"></div>
</div>
</div>
<div class="thumbs" id="thumbs">
{% if listing.photo_main %}<div class="thumb active" onclick="goToSlide(0)"><img src="{{ listing.photo_main.url }}"></div>{% endif %}
{% if listing.photo_1 %}<div class="thumb" onclick="goToSlide(1)"><img src="{{ listing.photo_1.url }}"></div>{% endif %}
{% if listing.photo_2 %}<div class="thumb" onclick="goToSlide(2)"><img src="{{ listing.photo_2.url }}"></div>{% endif %}
{% if listing.photo_3 %}<div class="thumb" onclick="goToSlide(3)"><img src="{{ listing.photo_3.url }}"></div>{% endif %}
{% if listing.photo_4 %}<div class="thumb" onclick="goToSlide(4)"><img src="{{ listing.photo_4.url }}"></div>{% endif %}
{% if listing.photo_5 %}<div class="thumb" onclick="goToSlide(5)"><img src="{{ listing.photo_5.url }}"></div>{% endif %}
{% if listing.photo_6 %}<div class="thumb" onclick="goToSlide(6)"><img src="{{ listing.photo_6.url }}"></div>{% endif %}
</div>
<div class="content">
<main>
<a href="{% url 'main:listing' %}" class="back-link"><i class="fa fa-arrow-left"></i> {{ nav_back|default:"Zurueck" }}</a>
<div class="price-section">
<div class="price-tag">EUR {{ listing.json_content.property_price }}</div>
<div class="prop-id">{{ label_property_id|default:"ID" }}: 123K-{{ listing.property_id|default:listing.id }}</div>
</div>
<div class="specs">
<div class="spec"><div class="spec-icon"><i class="fa fa-bed"></i></div><div class="spec-value">{{ listing.json_content.bedrooms }}</div><div class="spec-lbl">{{ label_bedrooms|default:"Schlafzimmer" }}</div></div>
<div class="spec"><div class="spec-icon"><i class="fa fa-bath"></i></div><div class="spec-value">{{ listing.json_content.bathrooms }}</div><div class="spec-lbl">{{ label_bathrooms|default:"Badezimmer" }}</div></div>
<div class="spec"><div class="spec-icon"><i class="fa fa-expand"></i></div><div class="spec-value">{{ listing.json_content.area }}</div><div class="spec-lbl">{{ label_area|default:"Flaeche" }} {{ label_sqm|default:"m2" }}</div></div>
<div class="spec"><div class="spec-icon"><i class="fa fa-map-o"></i></div><div class="spec-value">{{ listing.json_content.size }}</div><div class="spec-lbl">{{ label_sqm|default:"m2" }}</div></div>
<div class="spec"><div class="spec-icon"><i class="fa fa-building"></i></div><div class="spec-value">{{ listing.json_content.floors }}</div><div class="spec-lbl">{{ label_floors|default:"Etagen" }}</div></div>
<div class="spec"><div class="spec-icon"><i class="fa fa-car"></i></div><div class="spec-value">{{ listing.json_content.garage }}</div><div class="spec-lbl">{{ label_garage|default:"Garage" }}</div></div>
<div class="spec"><div class="spec-icon"><i class="fa fa-home"></i></div><div class="spec-value" style="font-size:14px">{{ listing.json_content.property_type }}</div><div class="spec-lbl">{{ label_property_type|default:"Objektart" }}</div></div>
<div class="spec"><div class="spec-icon"><i class="fa fa-tag"></i></div><div class="spec-value" style="font-size:14px">{{ listing.json_content.property_status }}</div><div class="spec-lbl">{{ label_property_status|default:"Status" }}</div></div>
</div>
{% if listing.json_content.property_description %}
<div class="section">
<h2 class="section-title">{{ label_description|default:"Beschreibung" }}</h2>
<p class="desc-text">{{ listing.json_content.property_description }}</p>
</div>
{% endif %}
<div class="section">
<h2 class="section-title">{{ label_details|default:"Details" }}</h2>
<div class="details-grid">
{% if listing.json_content.city %}<div class="detail-row"><span class="detail-lbl">{{ filter_location|default:"Ort" }}</span><span class="detail-val">{{ listing.json_content.city|default:listing.location }}</span></div>{% endif %}
{% if listing.json_content.country %}<div class="detail-row"><span class="detail-lbl">{{ CountryP|default:"Land" }}</span><span class="detail-val">{{ country_name_translated }}</span></div>{% endif %}
<div class="detail-row"><span class="detail-lbl">{{ label_property_id|default:"ID" }}</span><span class="detail-val">123K-{{ listing.property_id|default:listing.id }}</span></div>
</div>
</div>
<div class="section">
<h2 class="section-title">{{ label_location|default:"Standort" }}</h2>
<div class="map-container">
<iframe src="https://www.openstreetmap.org/export/embed.html?bbox=13.5%2C42.5%2C19.5%2C46.5&layer=mapnik" allowfullscreen loading="lazy"></iframe>
</div>
</div>
</main>
<aside class="sidebar">
{% if listing.realtor %}
<div class="card">
<h3 class="card-title">{{ dropdown_realtor|default:"Makler" }}</h3>
<div class="agent-box">
<img src="{% if listing.realtor.profile_image %}{{ listing.realtor.profile_image.url }}{% else %}{% static 'images/user.png' %}{% endif %}" class="agent-img" alt="">
<div>
<div class="agent-name">{{ listing.realtor.first_name }} {{ listing.realtor.last_name }}</div>
<div class="agent-role">{{ dropdown_realtor|default:"Immobilienmakler" }}</div>
</div>
</div>
{% if listing.realtor.phone %}<p style="margin:8px 0;font-size:14px"><i class="fa fa-phone" style="color:var(--primary);margin-right:8px"></i>{{ listing.realtor.phone }}</p>{% endif %}
{% if listing.realtor.email %}<p style="margin:8px 0;font-size:14px"><i class="fa fa-envelope" style="color:var(--primary);margin-right:8px"></i>{{ listing.realtor.email }}</p>{% endif %}
</div>
{% endif %}
<div class="card">
<h3 class="card-title">{{ btn_contact_agent|default:"Kontakt" }}</h3>
<form method="POST" action="#">
{% csrf_token %}
<input type="hidden" name="property_id" value="{{ listing.id }}">
<div class="form-group"><label>{{ contact_name|default:"Name" }}</label><input type="text" name="name" required></div>
<div class="form-group"><label>{{ contact_email|default:"E-Mail" }}</label><input type="email" name="email" required></div>
<div class="form-group"><label>{{ contact_phone|default:"Telefon" }}</label><input type="tel" name="phone"></div>
<div class="form-group"><label>{{ contact_message|default:"Nachricht" }}</label><textarea name="message"></textarea></div>
<button type="submit" class="btn btn-primary"><i class="fa fa-paper-plane"></i> {{ btn_send_message|default:"Senden" }}</button>
</form>
<a href="tel:+385123456789" class="btn btn-secondary"><i class="fa fa-phone"></i> {{ Contact|default:"Anrufen" }}</a>
<a href="/{{ language }}/expose/{{ listing.id }}/" target="_blank" class="btn btn-secondary"><i class="fa fa-file-pdf"></i> {{ expose_label }}</a>
</div>
</aside>
</div>
</div>
<div class="lightbox" id="lightbox">
<button class="lightbox-close" onclick="closeLightbox()">&times;</button>
<button class="lightbox-nav prev" onclick="lightboxNav(-1)"><i class="fa fa-chevron-left"></i></button>
<img src="" id="lightboxImg" alt="">
<button class="lightbox-nav next" onclick="lightboxNav(1)"><i class="fa fa-chevron-right"></i></button>
</div>
<script>
var images=[{% if listing.photo_main %}"{{ listing.photo_main.url }}"{% endif %}{% if listing.photo_1 %},"{{ listing.photo_1.url }}"{% endif %}{% if listing.photo_2 %},"{{ listing.photo_2.url }}"{% endif %}{% if listing.photo_3 %},"{{ listing.photo_3.url }}"{% endif %}{% if listing.photo_4 %},"{{ listing.photo_4.url }}"{% endif %}{% if listing.photo_5 %},"{{ listing.photo_5.url }}"{% endif %}{% if listing.photo_6 %},"{{ listing.photo_6.url }}"{% endif %}];
var currentIdx=0;var totalSlides=images.length||1;var slider=document.getElementById('gallerySlider');var dotsContainer=document.getElementById('galleryDots');
document.getElementById('totalSlides').textContent=totalSlides;
for(var i=0;i<totalSlides;i++){var dot=document.createElement('button');dot.className='gallery-dot'+(i===0?' active':'');dot.onclick=(function(idx){return function(){goToSlide(idx)}})(i);dotsContainer.appendChild(dot)}
function updateSlider(){slider.style.transform='translateX(-'+currentIdx*100+'%)';document.getElementById('currentSlide').textContent=currentIdx+1;document.querySelectorAll('.gallery-dot').forEach(function(d,i){d.classList.toggle('active',i===currentIdx)});document.querySelectorAll('.thumb').forEach(function(t,i){t.classList.toggle('active',i===currentIdx)})}
function changeSlide(dir){currentIdx=(currentIdx+dir+totalSlides)%totalSlides;updateSlider()}
function goToSlide(idx){currentIdx=idx;updateSlider()}
var touchStartX=0,touchEndX=0;
slider.addEventListener('touchstart',function(e){touchStartX=e.changedTouches[0].screenX},{passive:true});
slider.addEventListener('touchend',function(e){touchEndX=e.changedTouches[0].screenX;if(touchStartX-touchEndX>50)changeSlide(1);if(touchEndX-touchStartX>50)changeSlide(-1)},{passive:true});
var lbIdx=0;
function openLightbox(idx){lbIdx=idx;document.getElementById('lightboxImg').src=images[idx];document.getElementById('lightbox').classList.add('active');document.body.style.overflow='hidden'}
function closeLightbox(){document.getElementById('lightbox').classList.remove('active');document.body.style.overflow=''}
function lightboxNav(dir){lbIdx=(lbIdx+dir+images.length)%images.length;document.getElementById('lightboxImg').src=images[lbIdx]}
document.addEventListener('keydown',function(e){if(e.key==='Escape')closeLightbox();if(e.key==='ArrowLeft')lightboxNav(-1);if(e.key==='ArrowRight')lightboxNav(1)});
</script>
{% endblock body %}